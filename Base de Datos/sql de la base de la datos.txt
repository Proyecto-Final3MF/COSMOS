CREATE TABLE rol (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL
);

CREATE TABLE categoria (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL
);

CREATE TABLE usuario (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    contrasena VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    foto_perfil VARCHAR(255) DEFAULT 'Assets/imagenes/perfil/fotodefault.webp',
    rol_id INT, FOREIGN KEY (rol_id) REFERENCES rol(id)
);

CREATE TABLE producto (
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(255) NOT NULL,
    imagen VARCHAR(255) NOT NULL,
    id_cat INT NOT NULL, FOREIGN KEY (id_cat) REFERENCES categoria(id),
    id_usuario INT NOT NULL, FOREIGN KEY (id_usuario) REFERENCES usuario(id)
);


CREATE TABLE estado(
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL
);

CREATE TABLE solicitud (
    id INT AUTO_INCREMENT PRIMARY KEY,
    titulo VARCHAR(200) NOT NULL,
    cliente_id INT NOT NULL, FOREIGN KEY (cliente_id) REFERENCES usuario(id),
    tecnico_id INT NULL, FOREIGN KEY (tecnico_id) REFERENCES usuario(id),
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    fecha_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    prioridad ENUM ('baja', 'media', 'alta', 'urgente') DEFAULT 'media',
    producto_id INT NOT NULL, FOREIGN KEY (producto_id) REFERENCES producto(id),
    estado_id INT, FOREIGN KEY (estado_id) REFERENCES estado(id),
    descripcion TEXT NOT NULL
);

CREATE TABLE historial (
    id INT AUTO_INCREMENT PRIMARY KEY,
    usuario VARCHAR(100),
    usuario_id INT,
    accion VARCHAR(100),
    item VARCHAR(100),
    item_id INT,
    fecha_hora timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    obs VARCHAR(255)
);

CREATE TABLE mensaje (
    id INT AUTO_INCREMENT PRIMARY KEY,
    usuario_id INT NOT NULL,
    receptor_id INT NULL,
    mensaje TEXT NOT NULL,
    fecha TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE historia_solicitud (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_solicitud INT, FOREIGN KEY (id_solicitud) REFERENCES solicitud(id),
    evento VARCHAR (255),
    fecha_hora TIMESTAMP
);

CREATE TABLE notificacion (
    id INT AUTO_INCREMENT PRIMARY KEY,
    usuario_id INT NOT NULL, 
    mensaje TEXT NOT NULL,
    leida TINYINT(1) DEFAULT 0, 
    fecha TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (usuario_id) REFERENCES usuario(id)
);

CREATE TABLE reviews (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_solicitud INT, FOREIGN KEY (id_solicitud) REFERENCES  solicitud(id),
    id_tecnico INT, FOREIGN KEY (id_tecnico) REFERENCES  usuario(id),
    id_cliente INT, FOREIGN KEY (id_cliente) REFERENCES  usuario(id),
    comentario VARCHAR(255)
);

INSERT INTO `estado`(`id`, `nombre`) VALUES ('1','Disponible');
INSERT INTO `estado`(`id`, `nombre`) VALUES ('2','En diagonostico');
INSERT INTO `estado`(`id`, `nombre`) VALUES ('3','En espera de repuestos');
INSERT INTO `estado`(`id`, `nombre`) VALUES ('4','En reparacion');
INSERT INTO `estado`(`id`, `nombre`) VALUES ('5','Finalizado');
INSERT INTO `rol`(`id`, `nombre`) VALUES ('1','Tecnico');
INSERT INTO `rol`(`id`, `nombre`) VALUES ('2','Cliente');
INSERT INTO `rol`(`id`, `nombre`) VALUES ('3','Admin');
INSERT INTO `categoria` (`id`, `nombre`) VALUES
(1, 'Laptop'),
(2, 'Celular'),
(3, 'Televisión'),
(4, 'Monitor'),
(5, 'Impresora'),
(6, 'Consola de Videojuegos'),
(7, 'Router/Módem'),
(8, 'Smartwatch'),
(9, 'Cámara Digital'),
(10, 'Disco Duro Externo');